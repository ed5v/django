
{% extends 'LAYOUT.html'%}

{% load static %}

{% block title %} ORDEN {% endblock %}

{% block content %}

<h1> MENÚ </h1>

<div class="container">
  <!-- Sección izquierda: Menú -->
  <div class="menu-section">
    <h2>Menú</h2>

     <!-- Categoría Entradas -->
    <h3>Entradas</h3>
    <ul>
      <li>
        Coctel de Camarón - $120
        <button onclick="agregarProducto(1, 'Coctel de Camarón', 120)">Agregar</button>
      </li>
      <li>
        Empanadas de Camarón - $85
        <button onclick="agregarProducto(2, 'Empanadas de Camarón', 85)">Agregar</button>
      </li>
      <li>
        Tostadas de Ceviche - $70
        <button onclick="agregarProducto(3, 'Tostadas de Ceviche', 70)">Agregar</button>
      </li>
    </ul>


    {% for categoria in categorias %}
      <h3>{{ categoria.nombre }}</h3>
      <ul>
        {% for producto in categoria.producto_set.all %}
          <li>
            {{ producto.nombre }} - ${{ producto.precio }}
            <button onclick="agregarProducto({{ producto.id }}, '{{ producto.nombre }}')">Agregar</button>
          </li>
        {% endfor %}
      </ul>
    {% endfor %}


  </div>

  <!-- Sección derecha: Ticket del cliente -->
  <div class="ticket-section">
    <h2>Ticket Cliente #<span id="cliente-id">123</span></h2>
    <div id="ticket-contenido">
      <!-- Ticket dinámico se genera aquí -->
    </div>
    <hr>
    <h3>Total: $<span id="ticket-total">0</span></h3>
  </div>
</div>

<!-- Modal para observaciones -->
<div id="modal" style="display:none; position:fixed; top:20%; left:30%; background:#fff; padding:20px; box-shadow: 0 0 10px #000;">
  <h3>Observaciones para <span id="modal-producto-nombre"></span></h3>
  <textarea id="observaciones" rows="4" cols="30" placeholder="Sin cebolla, bien cocido, etc."></textarea><br><br>
  <button onclick="enviarProducto()">Agregar al pedido</button>
  <button onclick="cerrarModal()">Cancelar</button>
</div>

<script>
let productoSeleccionado = null;
let productoNombre = '';
let productoPrecio = 0;
let ticket = [];

function agregarProducto(id, nombre, precio) {
  productoSeleccionado = id;
  productoNombre = nombre;
  productoPrecio = precio;
  document.getElementById('modal-producto-nombre').innerText = nombre;
  document.getElementById('observaciones').value = '';
  document.getElementById('modal').style.display = 'block';
}

function cerrarModal() {
  document.getElementById('modal').style.display = 'none';
}

function enviarProducto() {
  const observaciones = document.getElementById('observaciones').value;

  // Añade producto localmente (sin backend)
  ticket.push({
    producto: productoNombre,
    precio: productoPrecio,
    observaciones: observaciones || null,
    cantidad: 1
  });

  cerrarModal();
  actualizarTicket();
}

function actualizarTicket() {
  const ticketDiv = document.getElementById('ticket-contenido');
  const totalSpan = document.getElementById('ticket-total');

  let total = 0;
  let html = '<ul>';

  ticket.forEach(item => {
    total += item.precio * item.cantidad;
    html += `<li>${item.cantidad}x ${item.producto} - $${item.precio}`;
    if (item.observaciones) {
      html += `<br><small>Obs: ${item.observaciones}</small>`;
    }
    html += '</li>';
  });

  html += '</ul>';
  ticketDiv.innerHTML = html;
  totalSpan.innerText = total.toFixed(2);
}
</script>

<style>
.container {
  display: flex;
  gap: 20px;
}
.menu-section, .ticket-section {
  width: 50%;
  padding: 20px;
  border: 1px solid #ccc;
  background-color: #f9f9f9;
}
.ticket-section {
  background-color: #fffbea;
}
button {
  margin-left: 10px;
  padding: 4px 10px;
  background-color: #0077b6;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
button:hover {
  background-color: #023e8a;
}
h3 {
  margin-top: 15px;
}
</style>
{% endblock %}